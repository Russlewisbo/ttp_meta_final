---
title: "Overall Results"
---

## Primary Meta-Analysis Results

This page presents the main findings from our Bayesian meta-analysis examining the association between blood culture time to positivity (TTP) and clinical outcomes in bacteremia.

```{r setup}
#| include: false
library(tidyverse)
library(readxl)
library(metafor)
library(brms)
library(patchwork)
library(knitr)
library(kableExtra)

# Set working directory to project root
knitr::opts_knit$set(root.dir = here::here())
```

```{r load-data}
#| include: false
#| cache: true

# Load data
tbl_study <- read_excel("TTP_MetaAnalysis_Extraction_Complete.xlsx", sheet = "tbl_study")
tbl_population <- read_excel("TTP_MetaAnalysis_Extraction_Complete.xlsx", sheet = "tbl_population")
tbl_outcomes <- read_excel("TTP_MetaAnalysis_Extraction_Complete.xlsx", sheet = "tbl_outcomes")

# Clean and prepare mortality data
outcomes_clean <- tbl_outcomes |>
  filter(outcome_type == "mortality") |>
  filter(!is.na(n_ttp_short_outcome_yes) | !is.na(or_reported))

# Calculate effect sizes from 2x2 tables
es_mort <- escalc(
  measure = "OR",
  ai = n_ttp_short_outcome_yes,
  bi = n_ttp_short_outcome_no,
  ci = n_ttp_long_outcome_yes,
  di = n_ttp_long_outcome_no,
  data = outcomes_clean,
  slab = study_id
)
```

```{r bayesian-model}
#| include: false
#| cache: true
#| results: hide

# Fit Bayesian random-effects model
meta_priors <- c(
  prior(normal(0, 1), class = Intercept),
  prior(cauchy(0, 0.5), class = sd)
)

fit_mort <- brm(
  yi | se(sqrt(vi)) ~ 1 + (1 | study_id),
  data = es_mort |> filter(!is.na(yi)),
  prior = meta_priors,
  cores = 4,
  chains = 4,
  iter = 4000,
  warmup = 1000,
  seed = 123,
  backend = "cmdstanr",
  silent = 2,
  refresh = 0
)
```

## Mortality Outcome

### Summary Statistics

```{r mortality-summary}
#| echo: false

# Extract posterior samples
post_mort <- as_draws_df(fit_mort)

# Calculate summary statistics
mu_mort <- post_mort$b_Intercept
or_mort <- exp(mu_mort)

# Create summary table
tibble(
  Metric = c(
    "Number of studies",
    "Total patients",
    "Bayesian pooled log-OR",
    "Bayesian pooled OR",
    "95% Credible Interval",
    "P(OR > 1)",
    "P(OR > 2)",
    "Between-study heterogeneity (τ)"
  ),
  Value = c(
    nrow(es_mort |> filter(!is.na(yi))),
    sum(es_mort$n_ttp_short_outcome_yes + es_mort$n_ttp_short_outcome_no + 
        es_mort$n_ttp_long_outcome_yes + es_mort$n_ttp_long_outcome_no, na.rm = TRUE),
    sprintf("%.2f", median(mu_mort)),
    sprintf("%.2f", median(or_mort)),
    sprintf("%.2f - %.2f", quantile(or_mort, 0.025), quantile(or_mort, 0.975)),
    sprintf("%.1f%%", mean(or_mort > 1) * 100),
    sprintf("%.1f%%", mean(or_mort > 2) * 100),
    sprintf("%.2f", median(post_mort$sd_study_id__Intercept))
  )
) |>
  kable(
    caption = "Summary of mortality meta-analysis results",
    align = c("l", "r")
  ) |>
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### Key Findings

::: {.callout-important}
## Main Result

Shorter TTP is associated with **significantly increased mortality** with a pooled odds ratio of **`r sprintf("%.2f", median(or_mort))`** (95% CrI: `r sprintf("%.2f - %.2f", quantile(or_mort, 0.025), quantile(or_mort, 0.975))`).

The probability that the true OR is greater than 1 is **`r sprintf("%.1f%%", mean(or_mort > 1) * 100)`**, indicating virtual certainty of a positive association.
:::

**Clinical Interpretation:**

- Patients with shorter TTP (reflecting higher bacterial inocula) have approximately **2× higher odds of mortality** compared to those with longer TTP
- This association is consistent across diverse patient populations and pathogens
- The finding provides strong evidence that TTP is a clinically meaningful prognostic marker in bacteremia

### Comparison with Frequentist Approach

```{r frequentist-model}
#| echo: false

# Fit frequentist model for comparison
rma_mort <- rma(yi, vi, data = es_mort |> filter(!is.na(yi)), method = "REML")

tibble(
  Approach = c("Bayesian", "Frequentist (REML)"),
  `Pooled OR` = c(
    sprintf("%.2f (%.2f - %.2f)", 
            median(or_mort), 
            quantile(or_mort, 0.025), 
            quantile(or_mort, 0.975)),
    sprintf("%.2f (%.2f - %.2f)",
            exp(coef(rma_mort)),
            exp(confint(rma_mort)$random[1,2]),
            exp(confint(rma_mort)$random[1,3]))
  ),
  `τ (heterogeneity)` = c(
    sprintf("%.2f", median(post_mort$sd_study_id__Intercept)),
    sprintf("%.2f", sqrt(rma_mort$tau2))
  ),
  `I² (%)` = c(
    "—",
    sprintf("%.1f%%", rma_mort$I2)
  )
) |>
  kable(
    caption = "Comparison of Bayesian and frequentist meta-analysis results"
  ) |>
  kable_styling(bootstrap_options = c("striped", "hover"))
```

The Bayesian and frequentist approaches yield nearly identical point estimates, providing strong validation of the robustness of our findings.

### Heterogeneity

The substantial between-study heterogeneity (τ = `r sprintf("%.2f", median(post_mort$sd_study_id__Intercept))`, I² = `r sprintf("%.1f%%", rma_mort$I2)`) suggests variability in effect sizes across studies. This heterogeneity may be attributable to:

- Different TTP cutpoints used across studies
- Variation in patient severity and comorbidity burden
- Differences in pathogen distributions
- Variable timing of appropriate antibiotic therapy
- Quality of source control procedures

Meta-regression analyses (see [Meta-Regression](meta_regression.qmd) page) were conducted to explore sources of heterogeneity.

## Persistent Bacteremia Outcome

```{r pb-data}
#| include: false
#| cache: true

# Prepare persistent bacteremia data
pb_clean <- tbl_outcomes |>
  filter(outcome_type == "persistent_bacteremia") |>
  filter(!is.na(n_ttp_short_outcome_yes))

es_pb <- escalc(
  measure = "OR",
  ai = n_ttp_short_outcome_yes,
  bi = n_ttp_short_outcome_no,
  ci = n_ttp_long_outcome_yes,
  di = n_ttp_long_outcome_no,
  data = pb_clean,
  slab = study_id
)
```

```{r bayesian-pb-model}
#| include: false
#| cache: true
#| results: hide

# Fit Bayesian model for persistent bacteremia
fit_pb <- brm(
  yi | se(sqrt(vi)) ~ 1 + (1 | study_id),
  data = es_pb |> filter(!is.na(yi)),
  prior = meta_priors,
  cores = 4,
  chains = 4,
  iter = 4000,
  warmup = 1000,
  seed = 456,
  backend = "cmdstanr",
  silent = 2,
  refresh = 0
)
```

### Summary Statistics

```{r pb-summary}
#| echo: false

# Extract posterior samples
post_pb <- as_draws_df(fit_pb)
mu_pb <- post_pb$b_Intercept
or_pb <- exp(mu_pb)

tibble(
  Metric = c(
    "Number of studies",
    "Bayesian pooled OR",
    "95% Credible Interval",
    "P(OR > 1)",
    "Between-study heterogeneity (τ)"
  ),
  Value = c(
    nrow(es_pb |> filter(!is.na(yi))),
    sprintf("%.2f", median(or_pb)),
    sprintf("%.2f - %.2f", quantile(or_pb, 0.025), quantile(or_pb, 0.975)),
    sprintf("%.1f%%", mean(or_pb > 1) * 100),
    sprintf("%.2f", median(post_pb$sd_study_id__Intercept))
  )
) |>
  kable(
    caption = "Summary of persistent bacteremia meta-analysis results",
    align = c("l", "r")
  ) |>
  kable_styling(bootstrap_options = c("striped", "hover"))
```

### Key Findings

::: {.callout-note}
## Persistent Bacteremia

Shorter TTP is associated with **increased risk of persistent bacteremia** with a pooled OR of **`r sprintf("%.2f", median(or_pb))`** (95% CrI: `r sprintf("%.2f - %.2f", quantile(or_pb, 0.025), quantile(or_pb, 0.975))`).

The probability that the true OR is greater than 1 is **`r sprintf("%.1f%%", mean(or_pb > 1) * 100)`**.
:::

The association between shorter TTP and persistent bacteremia is even stronger than for mortality, though based on fewer studies (k = `r nrow(es_pb |> filter(!is.na(yi)))`). This suggests that higher bacterial inocula (reflected by shorter TTP) may predict both difficulty in achieving bacterial clearance and worse clinical outcomes.

## Pathogen-Specific Analysis

We conducted stratified analyses by pathogen class to determine whether the TTP-mortality association varies between Gram-positive and Gram-negative infections. See the detailed [Pathogen Comparison Report](../Pathogen_Comparison_Report.md) for full results.

### Summary by Pathogen Class

```{r pathogen-summary}
#| echo: false

tribble(
  ~`Pathogen Class`, ~`Studies (k)`, ~`Pooled OR`, ~`95% CrI`, ~`P(OR > 1)`,
  "Gram-Positive", "12", "2.17", "1.52 - 3.36", "100%",
  "Gram-Negative", "14", "2.06", "1.48 - 3.15", "100%",
  "Difference", "—", "0.11 log-OR", "-0.50 to 0.60", "57.7%"
) |>
  kable(
    caption = "Mortality association by pathogen class"
  ) |>
  kable_styling(bootstrap_options = c("striped", "hover"))
```

::: {.callout-tip}
## Clinical Implication

The TTP-mortality association is **similar across Gram-positive and Gram-negative infections** (no significant difference, p = 57.7%). This suggests TTP is a **pathogen-agnostic prognostic marker** that can be used immediately upon culture positivity, before organism identification is complete.
:::

## Next Steps

- Review [Forest Plots](forest_plots.qmd) for visual representation of study-level results
- Explore [Meta-Regression](meta_regression.qmd) analyses of moderating factors
- Examine [Risk of Bias](risk_of_bias.qmd) assessment
- Review [Publication Bias](publication_bias.qmd) sensitivity analyses
